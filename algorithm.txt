let Array<id_obat> = select id_obat from resep where id_konsultasi=$this
let Array<id_apotek> = select id from apotek where id_kota=$this

$expected = len(Array<id_obat>);
$results = {};
foreach(Array<id_apotek> as $apotek) {
    $counter = 0;
    foreach(Array<id_obat> as obat) {
        if ($this->apotek has $this->obat && $this->apotek->stock($this->obat) >= $this->obat->resep->needs) {
            $counter ++;
        }
    }

    if ($counter == $expected) {
        $results[$apotek.id] = $counter;
    }
}

$id_apotek_that_has_enough_stocks = Object.keys($results);

$selected_apoteks = [];

foreach($id_apotek_that_has_enough_stocks as $id) {
    $selected_apoteks = Apotek::where("id", $id);
}

function geoLocation() {
    ...
    Some code
    ...
}

# Possible outcomes

What if no apotek that provides the exact amount of resep/obat needed in nearest location (by city) -> Probably split resep, but chotto complex
atau nunggu apotek stok baru?

Todo

"ganti dokter" -> "ganti apotek"